# TanStack Query: Simplifying Data Fetching in React

TanStack Query, formerly known as React Query, is a powerful library that simplifies data fetching, caching, synchronization, and more in React applications. It helps you manage server-side data in a declarative way, reducing the complexity of making HTTP requests and managing state.

In this guide, we'll explore how to use the `useQuery` hook to fetch data efficiently.

## What is useQuery?

`useQuery` is a hook provided by TanStack Query that fetches data asynchronously and manages the loading, error, and success states for you. It abstracts away the complexity of handling data fetching logic in your components.

## Steps to Setup TanStack Query

Before using `useQuery`, you need to install TanStack Query and set it up in your React application.

### 1. Install TanStack Query:

First, install TanStack Query via npm, yarn, or pnpm:

```bash
# Using npm
npm install @tanstack/react-query

# Using yarn
yarn add @tanstack/react-query

# Using pnpm
pnpm add @tanstack/react-query
```

### 2. Set Up QueryClientProvider:

Wrap your application in the `QueryClientProvider` to provide TanStack Query's client to the component tree. This is typically done in your root application file:

```tsx
import React from "react";
import ReactDOM from "react-dom";
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import App from "./App";

const queryClient = new QueryClient();

ReactDOM.render(
  <QueryClientProvider client={queryClient}>
    <App />
  </QueryClientProvider>,
  document.getElementById("root")
);
```

## Using useQuery to Fetch Data

Now that TanStack Query is set up, let's dive into using the `useQuery` hook to fetch data.

### Example: Fetching Data from a REST API

Let's assume you want to fetch a list of users from an API. Here's how you can do it with `useQuery`:

```tsx
import React from "react";
import { useQuery } from "@tanstack/react-query";

const fetchUsers = async () => {
  const response = await fetch("https://jsonplaceholder.typicode.com/users");
  if (!response.ok) {
    throw new Error("Network response was not ok");
  }
  return response.json();
};

const UsersList = () => {
  const { data, error, isLoading } = useQuery(["users"], fetchUsers);

  if (isLoading) return <div>Loading...</div>;
  if (error instanceof Error)
    return <div>An error occurred: {error.message}</div>;

  return (
    <div>
      <h1>Users List</h1>
      <ul>
        {data.map((user) => (
          <li key={user.id}>{user.name}</li>
        ))}
      </ul>
    </div>
  );
};

export default UsersList;
```

### Explanation of the Code

#### fetchUsers Function

- This is an asynchronous function that fetches the data from an API (in this case, a sample API endpoint from [jsonplaceholder.typicode.com](https://jsonplaceholder.typicode.com))
- We use `fetch()` to make the HTTP request, and if the response is successful, we return the data in JSON format

#### useQuery Hook

- `useQuery` takes two arguments:
  1. The first argument is a unique key ('users' in this case) that identifies the query. This key helps TanStack Query manage caching and refetching
  2. The second argument is the function (`fetchUsers`) that fetches the data
- The hook returns an object with properties such as `data`, `error`, and `isLoading`:
  - `data`: The fetched data (in our case, the list of users)
  - `isLoading`: A boolean indicating if the data is still being fetched
  - `error`: Any error that occurred during the data fetching process

#### Conditional Rendering

- If the data is still loading, we display a loading message
- If there's an error, we display the error message
- Once the data is fetched successfully, we display the list of users

### Key Features of useQuery

#### Caching

- TanStack Query automatically caches the fetched data
- If you try to fetch the same data again, it will be instantly available from the cache without making another network request

#### Automatic Refetching

- By default, TanStack Query refetches data when:
  - The component remounts
  - The query key changes
  - The window is refocused
  - The network is reconnected

#### Error Handling

- TanStack Query provides built-in error handling
- Gives you easy access to error messages
- Makes it simple to manage failures in data fetching

#### Pagination and Infinite Queries

- For more complex data fetching scenarios like pagination or infinite scrolling
- TanStack Query offers additional hooks like `useInfiniteQuery` to handle these patterns

## Conclusion

With TanStack Query, fetching data in React applications has never been easier. The `useQuery` hook not only handles the fetching logic but also provides features like caching, error handling, and data synchronization. It greatly improves the development experience by abstracting away many complexities of traditional data fetching.

Now that you've seen how to use `useQuery` for fetching data, you can start integrating TanStack Query into your projects for cleaner, more maintainable code.
